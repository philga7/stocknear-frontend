<script lang="ts">
  const data = {
    stats: {
      totalReports: 8,
      positiveEpsSurprises: 6,
      positiveRevenueSurprises: 2,
      positiveEpsPercent: 75,
      positiveRevenuePercent: 25,
    },
    history: [
      {
        date: "2025-06-11",
        quarter: "Q4",
        year: 2025,
        time: "16:05:00",
        rsi: 73,
        iv: null,
        backward_4_days_close: 171.14,
        backward_4_days_change_percent: 1.81,
        backward_3_days_close: 174.02,
        backward_3_days_change_percent: 1.68,
        backward_2_days_close: 177.15,
        backward_2_days_change_percent: 1.8,
        backward_1_days_close: 177.48,
        backward_1_days_change_percent: 0.19,
        forward_0_days_close: 176.38,
        forward_0_days_change_percent: -0.62,
      },
      {
        date: "2025-03-10",
        quarter: "Q3",
        year: 2025,
        time: "16:05:00",
        rsi: 35,
        iv: 0.39,
        backward_4_days_close: 157.47,
        backward_4_days_change_percent: -2.81,
        backward_3_days_close: 161.56,
        backward_3_days_change_percent: 2.6,
        backward_2_days_close: 150.94,
        backward_2_days_change_percent: -6.57,
        backward_1_days_close: 155.16,
        backward_1_days_change_percent: 2.8,
        forward_0_days_close: 148.79,
        forward_0_days_change_percent: -4.11,
        open: 143.42,
        high: 145.78,
        low: 137.7,
        close: 144.18,
        open_change_percent: -3.61,
        high_change_percent: -2.02,
        low_change_percent: -7.45,
        close_change_percent: -3.1,
        forward_2_days_close: 150.89,
        forward_2_days_change_percent: 4.65,
        forward_3_days_close: 147.66,
        forward_3_days_change_percent: -2.14,
        forward_4_days_close: 149.27,
        forward_4_days_change_percent: 1.09,
        forward_6_days_close: 149.45,
        forward_6_days_change_percent: -2.96,
      },
      {
        date: "2024-12-09",
        quarter: "Q2",
        year: 2025,
        time: "16:05:00",
        rsi: 58,
        iv: 0.42,
        backward_4_days_close: 182.89,
        backward_4_days_change_percent: 0.82,
        backward_3_days_close: 188.19,
        backward_3_days_change_percent: 2.9,
        backward_2_days_close: 186.24,
        backward_2_days_change_percent: -1.04,
        backward_1_days_close: 191.69,
        backward_1_days_change_percent: 2.93,
        forward_0_days_close: 190.45,
        forward_0_days_change_percent: -0.65,
        open: 173.46,
        high: 177.8,
        low: 171.06,
        close: 177.74,
        open_change_percent: -8.92,
        high_change_percent: -6.64,
        low_change_percent: -10.18,
        close_change_percent: -6.67,
        forward_2_days_close: 178.58,
        forward_2_days_change_percent: 0.47,
        forward_3_days_close: 175.32,
        forward_3_days_change_percent: -1.83,
        forward_4_days_close: 173.39,
        forward_4_days_change_percent: -1.1,
        forward_6_days_close: 169.71,
        forward_6_days_change_percent: -0.89,
      },
      {
        date: "2024-09-09",
        quarter: "Q1",
        year: 2025,
        time: "16:05:00",
        rsi: 53,
        iv: null,
        backward_4_days_close: 139.5,
        backward_4_days_change_percent: -1.27,
        backward_3_days_close: 140.75,
        backward_3_days_change_percent: 0.9,
        backward_2_days_close: 142.61,
        backward_2_days_change_percent: 1.32,
        backward_1_days_close: 141.81,
        backward_1_days_change_percent: -0.56,
        forward_0_days_close: 139.89,
        forward_0_days_change_percent: -1.35,
        open: 154.23,
        high: 160.52,
        low: 153.12,
        close: 155.89,
        open_change_percent: 10.25,
        high_change_percent: 14.75,
        low_change_percent: 9.46,
        close_change_percent: 11.44,
        forward_2_days_close: 157.18,
        forward_2_days_change_percent: 0.83,
        forward_3_days_close: 161.38,
        forward_3_days_change_percent: 2.67,
        forward_4_days_close: 162.03,
        forward_4_days_change_percent: 0.4,
        forward_6_days_close: 167.47,
        forward_6_days_change_percent: -1.68,
      },
      {
        date: "2024-06-11",
        quarter: "Q4",
        year: 2024,
        time: "16:05:00",
        rsi: 56,
        iv: null,
        backward_4_days_close: 122.63,
        backward_4_days_change_percent: 2.13,
        backward_3_days_close: 123.5,
        backward_3_days_change_percent: 0.71,
        backward_2_days_close: 125.92,
        backward_2_days_change_percent: 1.96,
        backward_1_days_close: 124.5,
        backward_1_days_change_percent: -1.13,
        forward_0_days_close: 123.88,
        forward_0_days_change_percent: -0.5,
        open: 134.69,
        high: 140.96,
        low: 133.96,
        close: 140.38,
        open_change_percent: 8.73,
        high_change_percent: 13.79,
        low_change_percent: 8.14,
        close_change_percent: 13.32,
        forward_2_days_close: 139.85,
        forward_2_days_change_percent: -0.38,
        forward_3_days_close: 138.13,
        forward_3_days_change_percent: -1.23,
        forward_4_days_close: 141.31,
        forward_4_days_change_percent: 2.3,
        forward_6_days_close: 142.91,
        forward_6_days_change_percent: -1.2,
      },
      {
        date: "2024-03-11",
        quarter: "Q3",
        year: 2024,
        time: "16:05:00",
        rsi: 54,
        iv: null,
        backward_4_days_close: 110.94,
        backward_4_days_change_percent: -2.74,
        backward_3_days_close: 112.27,
        backward_3_days_change_percent: 1.2,
        backward_2_days_close: 114.54,
        backward_2_days_change_percent: 2.02,
        backward_1_days_close: 112.42,
        backward_1_days_change_percent: -1.85,
        forward_0_days_close: 114.13,
        forward_0_days_change_percent: 1.52,
        open: 126.26,
        high: 129.37,
        low: 124.6,
        close: 127.54,
        open_change_percent: 10.63,
        high_change_percent: 13.35,
        low_change_percent: 9.17,
        close_change_percent: 11.75,
        forward_2_days_close: 125.52,
        forward_2_days_change_percent: -1.58,
        forward_3_days_close: 125.53,
        forward_3_days_change_percent: 0.01,
        forward_4_days_close: 125.54,
        forward_4_days_change_percent: 0.01,
        forward_6_days_close: 129.19,
        forward_6_days_change_percent: 1.09,
      },
      {
        date: "2023-12-11",
        quarter: "Q2",
        year: 2024,
        time: "16:05:00",
        rsi: 56,
        iv: null,
        backward_4_days_close: 114.53,
        backward_4_days_change_percent: -1.08,
        backward_3_days_close: 112.03,
        backward_3_days_change_percent: -2.18,
        backward_2_days_close: 112.87,
        backward_2_days_change_percent: 0.75,
        backward_1_days_close: 113.61,
        backward_1_days_change_percent: 0.66,
        forward_0_days_close: 115.13,
        forward_0_days_change_percent: 1.34,
        open: 102.7,
        high: 104.95,
        low: 100.69,
        close: 100.81,
        open_change_percent: -10.8,
        high_change_percent: -8.84,
        low_change_percent: -12.54,
        close_change_percent: -12.44,
        forward_2_days_close: 102.99,
        forward_2_days_change_percent: 2.16,
        forward_3_days_close: 100.31,
        forward_3_days_change_percent: -2.6,
        forward_4_days_close: 103.32,
        forward_4_days_change_percent: 3.0,
        forward_6_days_close: 106.25,
        forward_6_days_change_percent: 1.19,
      },
      {
        date: "2023-09-11",
        quarter: "Q1",
        year: 2024,
        time: "16:05:00",
        rsi: 70,
        iv: null,
        backward_4_days_close: 123.98,
        backward_4_days_change_percent: 2.52,
        backward_3_days_close: 124.33,
        backward_3_days_change_percent: 0.28,
        backward_2_days_close: 125.09,
        backward_2_days_change_percent: 0.61,
        backward_1_days_close: 126.32,
        backward_1_days_change_percent: 0.98,
        forward_0_days_close: 126.71,
        forward_0_days_change_percent: 0.31,
        open: 112.08,
        high: 113.3,
        low: 107.3,
        close: 109.61,
        open_change_percent: -11.55,
        high_change_percent: -10.58,
        low_change_percent: -15.32,
        close_change_percent: -13.5,
        forward_2_days_close: 111.84,
        forward_2_days_change_percent: 2.03,
        forward_3_days_close: 113.66,
        forward_3_days_change_percent: 1.63,
        forward_4_days_close: 113.91,
        forward_4_days_change_percent: 0.22,
        forward_6_days_close: 112.77,
        forward_6_days_change_percent: 0.5,
      },
      {
        date: "2023-06-12",
        quarter: "Q4",
        year: 2023,
        time: "16:05:00",
        rsi: 81,
        iv: null,
        backward_4_days_close: 107.1,
        backward_4_days_change_percent: 0.16,
        backward_3_days_close: 105.25,
        backward_3_days_change_percent: -1.73,
        backward_2_days_close: 107.48,
        backward_2_days_change_percent: 2.12,
        backward_1_days_close: 109.85,
        backward_1_days_change_percent: 2.21,
        forward_0_days_close: 116.43,
        forward_0_days_change_percent: 5.99,
        open: 123.32,
        high: 123.99,
        low: 116.02,
        close: 116.68,
        open_change_percent: 5.92,
        high_change_percent: 6.49,
        low_change_percent: -0.35,
        close_change_percent: 0.21,
        forward_2_days_close: 122.27,
        forward_2_days_change_percent: 4.79,
        forward_3_days_close: 126.55,
        forward_3_days_change_percent: 3.5,
        forward_4_days_close: 125.46,
        forward_4_days_change_percent: -0.86,
        forward_6_days_close: 122.1,
        forward_6_days_change_percent: 0.05,
      },
      {
        date: "2023-03-09",
        quarter: "Q3",
        year: 2023,
        time: "16:05:00",
        rsi: 46,
        iv: null,
        backward_4_days_close: 89.25,
        backward_4_days_change_percent: 2.62,
        backward_3_days_close: 89.74,
        backward_3_days_change_percent: 0.55,
        backward_2_days_close: 88.36,
        backward_2_days_change_percent: -1.54,
        backward_1_days_close: 88.49,
        backward_1_days_change_percent: 0.15,
        forward_0_days_close: 86.87,
        forward_0_days_change_percent: -1.83,
        open: 84.41,
        high: 85.25,
        low: 82.88,
        close: 84.07,
        open_change_percent: -2.83,
        high_change_percent: -1.86,
        low_change_percent: -4.59,
        close_change_percent: -3.22,
        forward_2_days_close: 84.93,
        forward_2_days_change_percent: 1.02,
        forward_3_days_close: 84.56,
        forward_3_days_change_percent: -0.44,
        forward_4_days_close: 82.98,
        forward_4_days_change_percent: -1.87,
        forward_6_days_close: 85.26,
        forward_6_days_change_percent: 0.52,
      },
      {
        date: "2022-12-12",
        quarter: "Q2",
        year: 2023,
        time: "16:05:00",
        rsi: 58,
        iv: null,
        backward_4_days_close: 78.91,
        backward_4_days_change_percent: -0.65,
        backward_3_days_close: 78.78,
        backward_3_days_change_percent: -0.16,
        backward_2_days_close: 80.07,
        backward_2_days_change_percent: 1.64,
        backward_1_days_close: 79.86,
        backward_1_days_change_percent: -0.26,
        forward_0_days_close: 81.28,
        forward_0_days_change_percent: 1.78,
        open: 84.94,
        high: 85.58,
        low: 79.7,
        close: 80.56,
        open_change_percent: 4.5,
        high_change_percent: 5.29,
        low_change_percent: -1.94,
        close_change_percent: -0.89,
        forward_2_days_close: 81.82,
        forward_2_days_change_percent: 1.56,
        forward_3_days_close: 80.07,
        forward_3_days_change_percent: -2.14,
        forward_4_days_close: 79.58,
        forward_4_days_change_percent: -0.61,
        forward_6_days_close: 80.94,
        forward_6_days_change_percent: 0.55,
      },
      {
        date: "2022-09-12",
        quarter: "Q1",
        year: 2023,
        time: "16:05:00",
        rsi: 57,
        iv: null,
        backward_4_days_close: 73.83,
        backward_4_days_change_percent: -1.14,
        backward_3_days_close: 74.49,
        backward_3_days_change_percent: 0.89,
        backward_2_days_close: 74.65,
        backward_2_days_change_percent: 0.21,
        backward_1_days_close: 75.91,
        backward_1_days_change_percent: 1.69,
        forward_0_days_close: 77.08,
        forward_0_days_change_percent: 1.54,
        open: 76.06,
        high: 79.41,
        low: 75.78,
        close: 76.04,
        open_change_percent: -1.32,
        high_change_percent: 3.02,
        low_change_percent: -1.69,
        close_change_percent: -1.35,
        forward_2_days_close: 72.12,
        forward_2_days_change_percent: -5.16,
        forward_3_days_close: 70.24,
        forward_3_days_change_percent: -2.61,
        forward_4_days_close: 68.83,
        forward_4_days_change_percent: -2.01,
        forward_6_days_close: 68.11,
        forward_6_days_change_percent: -1.39,
      },
      {
        date: "2022-06-13",
        quarter: "Q4",
        year: 2022,
        time: "16:05:00",
        rsi: 30,
        iv: null,
        backward_4_days_close: 72.69,
        backward_4_days_change_percent: -0.38,
        backward_3_days_close: 71.38,
        backward_3_days_change_percent: -1.8,
        backward_2_days_close: 69.22,
        backward_2_days_change_percent: -3.03,
        backward_1_days_close: 67.14,
        backward_1_days_change_percent: -3.0,
        forward_0_days_close: 64.05,
        forward_0_days_change_percent: -4.6,
        open: 72.0,
        high: 72.43,
        low: 69.02,
        close: 70.72,
        open_change_percent: 12.41,
        high_change_percent: 13.08,
        low_change_percent: 7.76,
        close_change_percent: 10.41,
        forward_2_days_close: 69.7,
        forward_2_days_change_percent: -1.44,
        forward_3_days_close: 68.71,
        forward_3_days_change_percent: -1.42,
        forward_4_days_close: 67.72,
        forward_4_days_change_percent: -1.44,
        forward_6_days_close: 66.53,
        forward_6_days_change_percent: -1.7,
      },
      {
        date: "2022-03-10",
        quarter: "Q3",
        year: 2022,
        time: "16:05:00",
        rsi: 45,
        iv: null,
        backward_4_days_close: 76.49,
        backward_4_days_change_percent: -2.25,
        backward_3_days_close: 74.32,
        backward_3_days_change_percent: -2.84,
        backward_2_days_close: 73.33,
        backward_2_days_change_percent: -1.33,
        backward_1_days_close: 76.1,
        backward_1_days_change_percent: 3.78,
        forward_0_days_close: 76.65,
        forward_0_days_change_percent: 0.72,
        open: 76.7,
        high: 79.9,
        low: 74.0,
        close: 77.82,
        open_change_percent: 0.07,
        high_change_percent: 4.24,
        low_change_percent: -3.46,
        close_change_percent: 1.53,
        forward_2_days_close: 77.07,
        forward_2_days_change_percent: -0.96,
        forward_3_days_close: 80.6,
        forward_3_days_change_percent: 4.58,
        forward_4_days_close: 79.96,
        forward_4_days_change_percent: -0.79,
        forward_6_days_close: 81.68,
        forward_6_days_change_percent: 1.34,
      },
      {
        date: "2021-12-09",
        quarter: "Q2",
        year: 2022,
        time: "16:05:00",
        rsi: 35,
        iv: null,
        backward_4_days_close: 88.24,
        backward_4_days_change_percent: -1.94,
        backward_3_days_close: 88.94,
        backward_3_days_change_percent: 0.79,
        backward_2_days_close: 90.05,
        backward_2_days_change_percent: 1.25,
        backward_1_days_close: 88.94,
        backward_1_days_change_percent: -1.23,
        forward_0_days_close: 88.77,
        forward_0_days_change_percent: -0.19,
        open: 104.29,
        high: 106.34,
        low: 100.1,
        close: 102.63,
        open_change_percent: 17.48,
        high_change_percent: 19.79,
        low_change_percent: 12.76,
        close_change_percent: 15.61,
        forward_2_days_close: 100.89,
        forward_2_days_change_percent: -1.7,
        forward_3_days_close: 99.89,
        forward_3_days_change_percent: -0.99,
        forward_4_days_close: 103.65,
        forward_4_days_change_percent: 3.76,
        forward_6_days_close: 96.62,
        forward_6_days_change_percent: -6.39,
      },
      {
        date: "2021-09-13",
        quarter: "Q1",
        year: 2022,
        time: "16:05:00",
        rsi: 49,
        iv: null,
        backward_4_days_close: 88.72,
        backward_4_days_change_percent: -1.42,
        backward_3_days_close: 89.47,
        backward_3_days_change_percent: 0.85,
        backward_2_days_close: 89.54,
        backward_2_days_change_percent: 0.08,
        backward_1_days_close: 89.68,
        backward_1_days_change_percent: 0.16,
        forward_0_days_close: 88.89,
        forward_0_days_change_percent: -0.88,
        open: 86.19,
        high: 86.95,
        low: 84.73,
        close: 86.39,
        open_change_percent: -3.04,
        high_change_percent: -2.18,
        low_change_percent: -4.68,
        close_change_percent: -2.81,
        forward_2_days_close: 87.73,
        forward_2_days_change_percent: 1.55,
        forward_3_days_close: 87.25,
        forward_3_days_change_percent: -0.55,
        forward_4_days_close: 86.39,
        forward_4_days_change_percent: -0.99,
        forward_6_days_close: 86.92,
        forward_6_days_change_percent: 0.87,
      },
      {
        date: "2021-06-15",
        quarter: "Q4",
        year: 2021,
        time: "16:05:00",
        rsi: 56,
        iv: null,
        backward_4_days_close: 84.52,
        backward_4_days_change_percent: -0.11,
        backward_3_days_close: 82.3,
        backward_3_days_change_percent: -2.63,
        backward_2_days_close: 82.9,
        backward_2_days_change_percent: 0.73,
        backward_1_days_close: 82.62,
        backward_1_days_change_percent: -0.34,
        forward_0_days_close: 81.64,
        forward_0_days_change_percent: -1.19,
        open: 77.99,
        high: 78.55,
        low: 75.9,
        close: 77.08,
        open_change_percent: -4.47,
        high_change_percent: -3.78,
        low_change_percent: -7.03,
        close_change_percent: -5.59,
        forward_2_days_close: 77.56,
        forward_2_days_change_percent: 0.62,
        forward_3_days_close: 76.23,
        forward_3_days_change_percent: -1.71,
        forward_4_days_close: 77.99,
        forward_4_days_change_percent: 2.31,
        forward_6_days_close: 78.1,
        forward_6_days_change_percent: -0.74,
      },
      {
        date: "2021-03-10",
        quarter: "Q3",
        year: 2021,
        time: "16:00:00",
        rsi: 73,
        iv: null,
        backward_4_days_close: 65.61,
        backward_4_days_change_percent: -1.94,
        backward_3_days_close: 69.97,
        backward_3_days_change_percent: 6.65,
        backward_2_days_close: 72.16,
        backward_2_days_change_percent: 3.13,
        backward_1_days_close: 72.64,
        backward_1_days_change_percent: 0.67,
        forward_0_days_close: 72.12,
        forward_0_days_change_percent: -0.72,
        open: 67.65,
        high: 68.1,
        low: 65.43,
        close: 67.41,
        open_change_percent: -6.2,
        high_change_percent: -5.57,
        low_change_percent: -9.28,
        close_change_percent: -6.53,
        forward_2_days_close: 67.16,
        forward_2_days_change_percent: -0.37,
        forward_3_days_close: 67.73,
        forward_3_days_change_percent: 0.85,
        forward_4_days_close: 66.85,
        forward_4_days_change_percent: -1.3,
        forward_6_days_close: 66.74,
        forward_6_days_change_percent: 0.79,
      },
      {
        date: "2020-12-10",
        quarter: "Q2",
        year: 2021,
        time: "16:00:00",
        rsi: 59,
        iv: null,
        backward_4_days_close: 59.96,
        backward_4_days_change_percent: 1.16,
        backward_3_days_close: 59.8,
        backward_3_days_change_percent: -0.27,
        backward_2_days_close: 59.03,
        backward_2_days_change_percent: -1.29,
        backward_1_days_close: 59.73,
        backward_1_days_change_percent: 1.19,
        forward_0_days_close: 59.48,
        forward_0_days_change_percent: -0.42,
        open: 60.94,
        high: 61.0,
        low: 59.42,
        close: 60.61,
        open_change_percent: 2.45,
        high_change_percent: 2.56,
        low_change_percent: -0.1,
        close_change_percent: 1.9,
        forward_2_days_close: 60.76,
        forward_2_days_change_percent: 0.25,
        forward_3_days_close: 61.86,
        forward_3_days_change_percent: 1.81,
        forward_4_days_close: 62.78,
        forward_4_days_change_percent: 1.49,
        forward_6_days_close: 65.06,
        forward_6_days_change_percent: 2.28,
      },
      {
        date: "2020-09-10",
        quarter: "Q1",
        year: 2021,
        time: "16:00:00",
        rsi: 55,
        iv: null,
        backward_4_days_close: 57.1,
        backward_4_days_change_percent: -3.27,
        backward_3_days_close: 55.73,
        backward_3_days_change_percent: -2.4,
        backward_2_days_close: 55.32,
        backward_2_days_change_percent: -0.74,
        backward_1_days_close: 56.95,
        backward_1_days_change_percent: 2.95,
        forward_0_days_close: 57.33,
        forward_0_days_change_percent: 0.67,
        open: 60.71,
        high: 61.86,
        low: 56.87,
        close: 57.0,
        open_change_percent: 5.9,
        high_change_percent: 7.9,
        low_change_percent: -0.8,
        close_change_percent: -0.58,
        forward_2_days_close: 59.46,
        forward_2_days_change_percent: 4.32,
        forward_3_days_close: 60.94,
        forward_3_days_change_percent: 2.49,
        forward_4_days_close: 60.43,
        forward_4_days_change_percent: -0.84,
        forward_6_days_close: 59.75,
        forward_6_days_change_percent: -0.71,
      },
      {
        date: "2020-06-16",
        quarter: "Q4",
        year: 2020,
        time: "16:00:00",
        rsi: 56,
        iv: null,
        backward_4_days_close: 54.11,
        backward_4_days_change_percent: -0.13,
        backward_3_days_close: 51.31,
        backward_3_days_change_percent: -5.17,
        backward_2_days_close: 51.86,
        backward_2_days_change_percent: 1.07,
        backward_1_days_close: 53.25,
        backward_1_days_change_percent: 2.68,
        forward_0_days_close: 54.59,
        forward_0_days_change_percent: 2.52,
        open: 53.03,
        high: 53.74,
        low: 51.5,
        close: 51.52,
        open_change_percent: -2.86,
        high_change_percent: -1.56,
        low_change_percent: -5.66,
        close_change_percent: -5.62,
        forward_2_days_close: 53.69,
        forward_2_days_change_percent: 4.21,
        forward_3_days_close: 54.4,
        forward_3_days_change_percent: 1.32,
        forward_4_days_close: 55.12,
        forward_4_days_change_percent: 1.32,
        forward_6_days_close: 54.44,
        forward_6_days_change_percent: -1.36,
      },
      {
        date: "2020-03-12",
        quarter: "Q3",
        year: 2020,
        time: "16:00:00",
        rsi: 24,
        iv: null,
        backward_4_days_close: 47.37,
        backward_4_days_change_percent: -1.31,
        backward_3_days_close: 46.01,
        backward_3_days_change_percent: -2.87,
        backward_2_days_close: 48.58,
        backward_2_days_change_percent: 5.59,
        backward_1_days_close: 44.72,
        backward_1_days_change_percent: -7.95,
        forward_0_days_close: 39.8,
        forward_0_days_change_percent: -11.0,
        open: 44.45,
        high: 47.99,
        low: 43.42,
        close: 47.93,
        open_change_percent: 11.68,
        high_change_percent: 20.58,
        low_change_percent: 9.1,
        close_change_percent: 20.43,
        forward_2_days_close: 42.72,
        forward_2_days_change_percent: -10.87,
        forward_3_days_close: 46.86,
        forward_3_days_change_percent: 9.69,
        forward_4_days_close: 47.27,
        forward_4_days_change_percent: 0.87,
        forward_6_days_close: 45.65,
        forward_6_days_change_percent: 1.29,
      },
    ],
  };
  let rawData = data?.history || [];

  let earningsData = data?.stats;

  function calculateMetrics(data) {
    if (!data || data.length === 0)
      return { avgPriceImpact: 0, volatilityImpact: 0 };

    const nextDayChanges = data
      ?.map((item) => item?.forward_2_days_change_percent)
      ?.filter((change) => change !== undefined);

    // Average price impact
    const avgPriceImpact =
      nextDayChanges?.reduce((sum, change) => sum + change, 0) /
      nextDayChanges?.length;

    // Volatility impact (average absolute range)
    const volatilityImpact =
      data?.reduce((sum, item) => {
        if (item?.high && item?.low && item?.close) {
          const range = ((item.high - item.low) / item.close) * 100;
          return sum + range;
        }
        return sum;
      }, 0) / data?.length;

    return {
      avgPriceImpact: avgPriceImpact?.toFixed(1),
      volatilityImpact: volatilityImpact?.toFixed(1),
    };
  }

  const metrics = calculateMetrics(rawData);
</script>

<h2 class="text-xl sm:text-3xl font-bold mt-8 mb-5">
  Earnings Impact on Stock Price
</h2>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
  <div
    class="eps-beats-driver shadow-md bg-gray-100 dark:bg-[#1C1E22] rounded p-4"
  >
    <div class=" text-sm mb-2 flex items-center">
      <span>EPS Beats Estimate</span>
    </div>
    <div class="flex items-baseline">
      <span class="text-xl font-bold">{earningsData.positiveEpsPercent}%</span>
      <div class="flex flex-col ml-2">
        <span class="text-sm"
          >{`${earningsData?.positiveEpsSurprises}/${earningsData?.totalReports}`}
          quarters</span
        >
        <span class="text-xs text-violet-700 dark:text-violet-400">
          {earningsData?.positiveEpsSurprises > earningsData?.totalReports / 2
            ? "Above Average"
            : "Below Average"}
        </span>
      </div>
    </div>
  </div>

  <div
    class="revenue-beats-driver shadow-md bg-gray-100 dark:bg-[#1C1E22] rounded p-4"
  >
    <div class=" text-sm mb-2 flex items-center">
      <span>Revenue Beats Estimate</span>
    </div>
    <div class="flex items-baseline">
      <span class="text-xl font-bold"
        >{earningsData.positiveRevenuePercent}%</span
      >
      <div class="flex flex-col ml-2">
        <span class="text-sm"
          >{`${earningsData?.positiveRevenueSurprises}/${earningsData?.totalReports}`}
          quarters</span
        >
        <span class="text-xs text-red-800 dark:text-red-400">
          {earningsData?.positiveRevenueSurprises >
          earningsData?.totalReports / 2
            ? "Above Average"
            : "Below Average"}
        </span>
      </div>
    </div>
  </div>

  <div
    class="avg-price-impact-driver shadow-md bg-gray-100 dark:bg-[#1C1E22] rounded p-4"
  >
    <div class=" text-sm mb-2 flex items-center">
      <span>Avg. Price Impact</span>
    </div>
    <div class="flex items-baseline">
      <span class="text-xl font-bold"
        >{metrics?.avgPriceImpact >= 0
          ? "+"
          : ""}{metrics?.avgPriceImpact}%</span
      >
      <div class="flex flex-col ml-2">
        <span class="text-sm">Next Day</span>
        <span
          class="text-xs text-{metrics?.avgPriceImpact >= 0
            ? 'green'
            : 'red'}-400"
        >
          {metrics?.avgPriceImpact >= 0 ? "Positive" : "Negative"} Trend
        </span>
      </div>
    </div>
  </div>

  <div
    class="volatility-impact-driver shadow-md bg-gray-100 dark:bg-[#1C1E22] rounded p-4"
  >
    <div class=" text-sm mb-2 flex items-center">
      <span>Volatility Impact</span>
    </div>
    <div class="flex items-baseline">
      <span class="text-xl font-bold">Â±{metrics.volatilityImpact}%</span>
      <div class="flex flex-col ml-2">
        <span class="text-sm">Range</span>
        <span class="text-xs text-yellow-700 dark:text-yellow-400">
          {Number(metrics.volatilityImpact) > 3 ? "High" : "Normal"}
          Impact
        </span>
      </div>
    </div>
  </div>
</div>
